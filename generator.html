<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>자쿠드 제네레이터</title>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;700;900&display=swap" rel="stylesheet">
<style>
  html{font-size:100%}
  :root{--bg:#f4f7fb;--card-bg:#fff;--accent:#2563eb;--accent-2:#ffb86b;--muted:#6b7280;--shadow:rgba(10,20,40,0.12)}
  html.dark{--bg:#071018;--card-bg:#0b1724;--accent:#ffd166;--accent-2:#ffb86b;--muted:#9aa0ab;--shadow:rgba(0,0,0,0.45)}
  body{margin:0;font-family:"Noto Sans KR",system-ui,Arial;background:var(--bg);color:var(--muted)}
  .header{position:sticky;top:0;background:var(--card-bg);box-shadow:0 1px 0 rgba(0,0,0,0.04);z-index:1000}
  .header-top{display:flex;align-items:center;justify-content:space-between;padding:.9rem 1.25rem}
  .brand img{width:3rem;height:3rem;border-radius:6px}
  .header-nav{display:flex;align-items:center;justify-content:space-between;padding:.5rem 1.25rem;border-top:1px solid #eee}
  .wrap{max-width:1100px;margin:1.5rem auto;padding:1rem;display:flex;gap:1rem;align-items:flex-start}
  .left{flex:1;min-width:320px;display:flex;flex-direction:column;gap:1rem;align-items:center}
  .card-wrap{width:360px;height:480px;border-radius:14px;overflow:hidden;background:linear-gradient(180deg,rgba(255,255,255,0.03),rgba(0,0,0,0.02));box-shadow:0 18px 40px var(--shadow);display:flex;align-items:center;justify-content:center;position:relative}
  #card{width:84%;height:78%;border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:1.6rem;font-weight:900;color:#071018;text-align:center;padding:.5rem;transition:transform .28s}
  .right{width:320px;display:flex;flex-direction:column;gap:.9rem}
  .controls{display:flex;flex-direction:column;gap:.6rem}
  .btn{padding:.9rem 1rem;border-radius:10px;border:0;font-weight:900;cursor:pointer;font-size:1rem}
  .btn-pull{background:linear-gradient(90deg,var(--accent),var(--accent-2));color:#071018;box-shadow:0 10px 24px rgba(0,0,0,0.12)}
  .btn-10{background:#fff;border:1px solid rgba(0,0,0,0.06);font-weight:800}
  .meta{background:var(--card-bg);border-radius:10px;padding:.75rem;box-shadow:0 8px 22px var(--shadow);font-size:.95rem}
  .log{background:transparent;max-height:260px;overflow:auto;padding:.6rem;border-radius:8px;font-size:.95rem;color:var(--muted)}
  .log .entry{margin-bottom:.6rem;background:rgba(0,0,0,0.03);padding:.55rem;border-radius:8px;color:var(--muted)}
  @media(max-width:920px){.wrap{flex-direction:column;align-items:center}.right{width:100%}.card-wrap{width:88%;height:420px}}
</style>
</head>
<body>
<header class="header">
  <div class="header-top">
    <a class="brand" href="worship.html"><img id="logoGen" data-ibb="https://ibb.co/ZrgK1DJ" alt="logo"></a>
    <div style="display:flex;gap:1rem"><a href="worship.html">숭배하기</a><a href="bible.html">성경</a></div>
  </div>
  <div class="header-nav">
    <div></div>
    <div style="display:flex;align-items:center;gap:1rem">
      <div style="display:flex;align-items:center;gap:.5rem"><span style="color:var(--muted)">다크</span><label style="display:inline-block"><input id="themeToggleGen" type="checkbox"></label></div>
    </div>
  </div>
</header>

<main>
  <div class="wrap">
    <div class="left">
      <div class="card-wrap"><div class="card-placeholder" style="position:absolute;top:12px;left:12px;color:var(--muted)">연출 위치</div><div id="card">?</div></div>
      <div style="width:360px;max-width:88%;display:flex;justify-content:center;gap:.6rem;color:var(--muted)">확률: <strong style="color:var(--muted);font-weight:800">SSR 1% / SR 6% / R 93%</strong></div>
    </div>

    <div class="right">
      <div class="controls">
        <button id="pullBtn" class="btn btn-pull">한 번 뽑기</button>
        <button id="pull10Btn" class="btn btn-10">10연 뽑기</button>
        <button id="resetBtn" class="btn" style="background:transparent;border:1px solid rgba(0,0,0,0.06)">로그 초기화</button>
      </div>

      <div class="meta">
        <div style="display:flex;justify-content:space-between;margin-bottom:.35rem"><div>총 뽑기</div><div id="count">0</div></div>
        <div style="display:flex;justify-content:space-between;margin-bottom:.35rem"><div>SSR 횟수</div><div id="ssrCount">0</div></div>
        <div style="display:flex;justify-content:space-between;margin-bottom:.35rem"><div>SR 횟수</div><div id="srCount">0</div></div>
        <div style="display:flex;justify-content:space-between"><div>R 횟수</div><div id="rCount">0</div></div>
      </div>

      <div class="log" id="log"></div>
    </div>
  </div>
</main>

<script type="module">
/* logo try */
(function(){ const img=document.getElementById('logoGen'); const base=img.dataset.ibb; const cand=[base.replace('ibb.co','i.ibb.co')+'.png','/assets/logo.png']; let i=0; function next(){ if(i>=cand.length) return; img.src=cand[i++]; } img.addEventListener('error',next); next(); })();

/* theme */
(function(){ const t=document.getElementById('themeToggleGen'); const apply=v=>{ if(v==='dark') document.documentElement.classList.add('dark'); else document.documentElement.classList.remove('dark'); t.checked=(v==='dark'); }; const s=localStorage.getItem('theme')|| (window.matchMedia && window.matchMedia('(prefers-color-scheme:dark)').matches ? 'dark':'light'); apply(s); t.addEventListener('change',()=>{ const n=t.checked?'dark':'light'; localStorage.setItem('theme',n); apply(n); }); })();

/* Gacha logic */
const POOL = [
  { id:'A', name:'자쿠드-전설', rarity:'SSR', weight:1 },
  { id:'B', name:'자쿠드-희귀', rarity:'SR', weight:6 },
  { id:'C', name:'자쿠드-일반', rarity:'R', weight:93 }
];

const cardEl = document.getElementById('card');
const pullBtn = document.getElementById('pullBtn');
const pull10Btn = document.getElementById('pull10Btn');
const resetBtn = document.getElementById('resetBtn');
const logEl = document.getElementById('log');
const countEl = document.getElementById('count');
const ssrEl = document.getElementById('ssrCount');
const srEl = document.getElementById('srCount');
const rEl = document.getElementById('rCount');

const STORAGE_KEY = 'zk_gen_stats_v1';
let stats = JSON.parse(localStorage.getItem(STORAGE_KEY) || JSON.stringify({total:0,ssr:0,sr:0,r:0,history:[]}));

function saveStats(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(stats)); updateUI(); }
function updateUI(){
  countEl.textContent = stats.total;
  ssrEl.textContent = stats.ssr;
  srEl.textContent = stats.sr;
  rEl.textContent = stats.r;
  logEl.innerHTML = '';
  stats.history.slice().reverse().forEach(h=>{
    const d = document.createElement('div'); d.className='entry'; d.textContent = `[${new Date(h.ts).toLocaleTimeString()}] ${h.rarity} 획득: ${h.name}`; logEl.appendChild(d);
  });
}

function weightedDraw(pool){
  const total = pool.reduce((s,p)=>s+p.weight,0);
  let r = Math.random()*total;
  for(const p of pool){ r-=p.weight; if(r<=0) return p; }
  return pool[pool.length-1];
}

async function doPull(count){
  // disable controls
  pullBtn.disabled = true; pull10Btn.disabled = true;
  const results = [];
  for(let i=0;i<count;i++){
    // simple 연출
    cardEl.textContent = '연출 중…';
    cardEl.style.opacity = '0.9';
    await new Promise(r=>setTimeout(r, 600)); // 연출
    const res = weightedDraw(POOL);
    // show
    cardEl.textContent = res.name;
    if(res.rarity==='SSR') cardEl.style.background='linear-gradient(180deg,#ffd166,#ffb86b)';
    else if(res.rarity==='SR') cardEl.style.background='linear-gradient(180deg,#7cf6ff,#4bbfd9)';
    else cardEl.style.background='linear-gradient(180deg,#d7d9df,#9aa0ab)';
    // stats
    stats.total+=1;
    if(res.rarity==='SSR') stats.ssr+=1;
    if(res.rarity==='SR') stats.sr+=1;
    if(res.rarity==='R') stats.r+=1;
    stats.history.push({ ts: Date.now(), id: res.id, name: res.name, rarity: res.rarity });
    results.push(res);
    await new Promise(r=>setTimeout(r, 180)); // 짧은 텀
  }
  saveStats();
  // re-enable
  pullBtn.disabled = false; pull10Btn.disabled = false;
  // summary
  return results;
}

pullBtn.addEventListener('click', async ()=>{
  await doPull(1);
});

pull10Btn.addEventListener('click', async ()=>{
  await doPull(10);
});

resetBtn.addEventListener('click', ()=>{
  stats = { total:0, ssr:0, sr:0, r:0, history:[] };
  saveStats();
  cardEl.textContent='?'; cardEl.style.background='';
});

/* init */
updateUI();
if(!stats.history.length) { const p=document.createElement('div'); p.className='entry'; p.textContent='가챠 준비 완료'; logEl.appendChild(p); }
</script>
</body>
</html>
